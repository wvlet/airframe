<html><head><title>Airframe: airspec</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Taro L. Saito" /><meta name="description" content="Lightweight Building Blocks for Scala" /><meta name="og:image" content="/airframe/img/poster.png" /><meta name="image" property="og:image" content="/airframe/img/poster.png" /><meta name="og:title" content="Airframe: airspec" /><meta name="title" property="og:title" content="Airframe: airspec" /><meta name="og:site_name" content="Airframe" /><meta name="og:url" content="" /><meta name="og:type" content="website" /><meta name="og:description" content="Lightweight Building Blocks for Scala" /><link rel="icon" type="image/png" href="/airframe/img/favicon.png" /><meta name="twitter:title" content="Airframe: airspec" /><meta name="twitter:image" content="https://wvlet.org/airframe/img/poster.png" /><meta name="twitter:description" content="Lightweight Building Blocks for Scala" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/airframe/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/airframe/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/airframe/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/airframe/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/airframe/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/airframe/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/airframe/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/airframe/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/airframe/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/airframe/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/airframe/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/airframe/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/airframe/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/airframe/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/airframe/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/airframe/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/airframe/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/airframe/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/airframe/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/airframe/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/airframe/highlight/styles/ocean.css" /><link rel="stylesheet" href="/airframe/css/pattern-style.css" /><link rel="stylesheet" href="/airframe/css/overwrite.css" /><link rel="stylesheet" href="/airframe/css/solarized-dark.css" /><script async="async">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-98364158-1' , 'auto');
ga('send', 'pageview');
      </script></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/airframe/" class="brand"><div class="brand-wrapper"><span>Airframe</span></div></a></li> <li><a href="/airframe/docs/index.html" class="">Airframe Overview</a></li> <li><a href="/airframe/docs/release-notes.html" class="">Release Notes</a></li> <li><a href="/airframe/docs/airframe.html" class="">Airframe DI</a> <ul class="sub-section"> <li><a href="/airframe/docs/airframe.html#bind" class="">Bind</a></li> <li><a href="/airframe/docs/airframe.html#design" class="">Design</a></li> <li><a href="/airframe/docs/airframe.html#session" class="">Session</a></li> <li><a href="/airframe/docs/airframe.html#life-cycle" class="">Life Cycle</a></li> <li><a href="/airframe/docs/use-cases.html" class="">Use Cases</a></li> <li><a href="/airframe/docs/bindings.html" class="">Advanced Binding Types</a></li> <li><a href="/airframe/docs/debug.html" class="">Debugging DI</a></li> <li><a href="/airframe/docs/comparison.html" class="">DI Framework Comparison</a></li> <li><a href="/airframe/docs/internals.html" class="">Airframe Internals</a></li></ul></li> <li><a href="/airframe/docs/airspec.html" class="">AirSpec Testing Framework</a></li> <li><a href="/airframe/docs/index.html" class="">Airframe Modules</a> <ul class="sub-section"> <li><a href="/airframe/docs/airframe-canvas.html" class="">airframe-canvas</a></li> <li><a href="/airframe/docs/airframe-codec.html" class="">airframe-codec</a></li> <li><a href="/airframe/docs/airframe-config.html" class="">airframe-config</a></li> <li><a href="/airframe/docs/airframe-control.html" class="">airframe-control</a></li> <li><a href="/airframe/docs/airframe-fluentd.html" class="">airframe-fluentd</a></li> <li><a href="/airframe/docs/airframe-http.html" class="">airframe-http</a></li> <li><a href="/airframe/docs/airframe-http-recorder.html" class="">airframe-http-recorder</a></li> <li><a href="/airframe/docs/airframe-jdbc.html" class="">airframe-jdbc</a></li> <li><a href="/airframe/docs/airframe-jmx.html" class="">airframe-jmx</a></li> <li><a href="/airframe/docs/airframe-json.html" class="">airframe-json</a></li> <li><a href="/airframe/docs/airframe-launcher.html" class="">airframe-launcher</a></li> <li><a href="/airframe/docs/airframe-log.html" class="">airframe-log</a></li> <li><a href="/airframe/docs/airframe-metrics.html" class="">airframe-metrics</a></li> <li><a href="/airframe/docs/airframe-msgpack.html" class="">airframe-msgpack</a></li> <li><a href="/airframe/docs/airframe-scalatest.html" class="">airframe-scalatest</a></li> <li><a href="/airframe/docs/airframe-surface.html" class="">airframe-surface</a></li> <li><a href="/airframe/docs/airframe-sql.html" class="">airframe-sql</a></li></ul></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/wvlet/airframe" target="_blank" rel="noopener noreferrer"><i class="fa fa-eye"></i><span>Watchers<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/wvlet/airframe" target="_blank" rel="noopener noreferrer"><i class="fa fa-star-o"></i><span>Stars<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('Airframe Lightweight Building Blocks for Scala');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('Airframe Lightweight Building Blocks for Scala');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="wvlet" data-github-repo="airframe"><div class="content-wrapper"><section><h1 id="airspec">AirSpec</h1>

<p><a href="https://github.com/wvlet/airframe/tree/master/airspec">AirSpec</a> is a new functional testing framework for Scala and Scala.js.</p>

<ul>
  <li><a href="https://github.com/wvlet/airframe/tree/master/airspec">GitHub: AirSpec</a></li>
</ul>

<p>AirSpec uses pure Scala functions for writing test cases. This style requires no extra learning cost if you already know Scala. For advanced users, dependency injection to test cases and property-based testing are supported optionally.</p>

<p>AirSpec has nice properties for writing tests in Scala:</p>

<ul>
  <li>Simple usage: <code class="highlighter-rouge">import wvlet.airspec._</code> and extend <code class="highlighter-rouge">AirSpec</code> trait.</li>
  <li>Tests can be defined using plain Scala classes and methods.
    <ul>
      <li>Public methods in a class extending <code class="highlighter-rouge">AirSpec</code> trait will be your test cases.</li>
      <li>No annotation (like ones in <a href="https://junit.org/junit5/docs/current/user-guide/">JUnit5</a>) is necessary.</li>
    </ul>
  </li>
  <li>Testing with simple assertions: <code class="highlighter-rouge">assert(cond)</code>, <code class="highlighter-rouge">x shouldBe y</code>, etc.
    <ul>
      <li>No need to learn other complex DSLs.</li>
    </ul>
  </li>
  <li>Lifecycle management with <a href="https://wvlet.org/airframe/docs/airframe.html">Airframe DI</a>:
    <ul>
      <li>The arguments of test methods can be used to inject necessary services for running your tests.</li>
      <li>The lifecycle (e.g., start and shutdown) of the injected services can be managed by Airframe DI.</li>
    </ul>
  </li>
  <li>Nesting and reusing test cases with <code class="highlighter-rouge">context.run(spec)</code></li>
  <li>Handy keyword search for <em>sbt</em>: <code class="highlighter-rouge">&gt; testOnly -- (a pattern for class or method names)</code></li>
  <li>Property-based testing integrated with <a href="https://www.scalacheck.org/">ScalaCheck</a></li>
  <li>Scala 2.11, 2.12, 2.13, and Scala.js support</li>
</ul>

<p>AirSpec is already feature complete and ready to use in production. Actually, all modules of Airframe, including AirSpec, are tested by using AirSpec.
For providing better testing experience, we are now planning to add more features (e.g., better reporting, power assertions):</p>
<ul>
  <li><a href="https://github.com/wvlet/airframe/issues/606">Milestone: AirSpec 19</a></li>
</ul>

<p>To start using AirSpec, read <a href="#quick-start">Quick Start</a>.</p>

<h2 id="background--motivation">Background &amp; Motivation</h2>

<p>In Scala there are several rich testing frameworks like <a href="http://www.scalatest.org/">ScalaTests</a>, <a href="https://etorreborre.github.io/specs2/">Specs2</a>, <a href="https://github.com/lihaoyi/utest">uTest</a>, etc. We also have a simple testing framework like <a href="https://github.com/monix/minitest">minitest</a>. In 2019, Scala community has started an experiment to creating a nano-testing framework <a href="https://github.com/scala/nanotest-strawman">nanotest-strawman</a> based on minitest so that Scala users can have <a href="https://github.com/scala/scala-dev/issues/641">some standards for writing tests in Scala</a> without introducing third-party dependencies.</p>

<p>A problem here is, in order to write tests in Scala, we usually have only two choices: learning DSLs or being a minimalist:</p>

<ul>
  <li><strong>Complex DSLs</strong>:
    <ul>
      <li>ScalaTests supports <a href="http://www.scalatest.org/user_guide/selecting_a_style">various writing styles of tests</a>, and <a href="http://www.scalatest.org/user_guide/using_assertions">assersions</a>. We had no idea how to choose the best style for our team. To simplify this, uTest has picked only one of the styles from ScalaTests, but it’s still a new domain-specific language on top of Scala. Specs2 introduces its own testing syntax, and even <a href="https://etorreborre.github.io/specs2/">the very first example</a> can be cryptic for new people, resulting in high learning cost.</li>
      <li>With these rich testing frameworks, using a consistent writing style is challenging as they have too much flexibility in writing test; Using rich assertion syntax like <code class="highlighter-rouge">x should be (&gt;= 0)</code>, <code class="highlighter-rouge">x.name must_== "me"</code>, <code class="highlighter-rouge">Array(1, 2, 3) ==&gt; Array(1, 2, 3)</code>  needs practices and education within team members. We can force team members so as not to use them, but having a consensus on what can be used or not usually takes time.</li>
    </ul>
  </li>
  <li><strong>Too minimalistic framework:</strong>
    <ul>
      <li>On the other hand, a minimalist approach like minitest, which uses a limited set of syntax like <code class="highlighter-rouge">asserts</code> and <code class="highlighter-rouge">test("....")</code>, is too restricted. For example, I believe assertion syntax like <code class="highlighter-rouge">x shouldBe y</code> is a good invention in ScalaTest to make clear the meaning of assertions to represent <code class="highlighter-rouge">(value) shoudlBe (expected value)</code>. In minitest <code class="highlighter-rouge">assert(x == y)</code> has the same meaning, but the intention of test writers is not clear because we can write it in two ways: <code class="highlighter-rouge">assert(value == expected)</code> or <code class="highlighter-rouge">assert(expected == value)</code>. Minitest also has no feature for selecting test cases to run; It only supports specifying class names to run, which is just a basic functionality of <strong>sbt</strong>.</li>
      <li>A minimalist approach forces us to be like <a href="https://en.wikipedia.org/wiki/Zen">Zen</a> mode. We can extend minitest with rich assertions, but we still need to figure out the right balance between a minimalist and developing a DSL for our own teams.</li>
    </ul>
  </li>
</ul>

<h2 id="airspec-writing-tests-as-plain-functions-in-scala">AirSpec: Writing Tests As Plain Functions In Scala</h2>

<p>So where is a middle ground in-between these two extremes? We usually don’t want to learn too complex DSLs, and also we don’t want to be a minimalist, either.</p>

<p>Why can’t we <strong>use plain Scala functions to define tests</strong>? ScalaTest already has <a href="http://www.scalatest.org/user_guide/selecting_a_style">RefSpec</a> to write tests in Scala functions. Unfortunately, however, its support is limited only to Scala JVM as Scala.js does not support runtime reflections to list function names. Scala.js is powerful for developing web applications in Scala, so we don’t want to drop it, and the lack of runtime reflection in Scala.js is probably a reason why existing testing frameworks needed to develop their own DSLs like <code class="highlighter-rouge">test(....) {  test body } </code>.</p>

<p>Now listing functions in Scala.js is totally possible by using <a href="https://wvlet.org/airframe/docs/airframe-surface.html">airframe-surface</a>, which is a library to inspect parameters and methods in a class by using reflection (in Scala JVM) or Scala macros (in Scala.js). So it was a good timing for us to develop a new testing framework, which has more Scala-friendly syntax.</p>

<p>And also, if we define tests by using functions, it becomes possible to <strong>pass test dependencies through function arguments</strong>. Using local variables in a test class has been the best practice of setting up testing environments (e.g., database, servers, etc.), but it is not always ideal as we need to properly initialize and clean-up these variables for each test method by using setUp/tearDown (or before/after) methods. If we can simply pass these service instances to function arguments using <a href="https://wvlet.org/airframe/docs/airframe.html">Airframe DI</a>, which has a strong support of life-cycle management, we no longer need to write such setUp/tearDown steps for configuring testing environments. Once we define a production-quality service with proper lifecycle management hooks (using Airframe design and onStart/onShutdown hooks), we should be able to reuse these lifecycle management code even in test cases.</p>

<p>AirSpec was born with these ideas in mind by leveraging Airframe modules like Airframe Surface and DI. After implementing basic features of AirSpec, we’ve successfully <strong>migrated all of the test cases in 20+ Airframe modules into AirSpec</strong>, which were originally written in ScalaTest. Rewriting test cases was almost straightforward as AirSpec has handy <code class="highlighter-rouge">shouldBe</code> syntax and property testing support with ScalaCheck.</p>

<p>In the following sections, we will see how to write tests in a Scala-friendly style with AirSpec.</p>

<h1 id="quick-start">Quick Start</h1>

<p>To use AirSpec, add <code class="highlighter-rouge">"org.wvlet.airframe" %% "airspec"</code> to your test dependency and add <code class="highlighter-rouge">wvlet.airspec.Framework</code> as a TestFramework.</p>

<p>AirSpec uses <code class="highlighter-rouge">(year).(month).(patch)</code> versioning scheme. For example, version 19.8.x means a version released on August, 2019:</p>

<p><a href="http://central.maven.org/maven2/org/wvlet/airframe/airspec_2.12/"><img src="https://maven-badges.herokuapp.com/maven-central/org.wvlet.airframe/airspec_2.12/badge.svg" alt="Maven Central" /></a></p>

<p><strong>build.sbt</strong></p>
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="s">"org.wvlet.airframe"</span> <span class="o">%%</span> <span class="s">"airspec"</span> <span class="o">%</span> <span class="s">"(version)"</span> <span class="o">%</span> <span class="s">"test"</span>
<span class="n">testFrameworks</span> <span class="o">+=</span> <span class="k">new</span> <span class="nc">TestFramework</span><span class="o">(</span><span class="s">"wvlet.airspec.Framework"</span><span class="o">)</span>
</code></pre></div></div>

<p>If you have multiple sub projects, add the above <code class="highlighter-rouge">testFramework</code> setting to each sub project.</p>

<p>For Scala.js, use <code class="highlighter-rouge">%%%</code>:</p>
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="s">"org.wvlet.airframe"</span> <span class="o">%%%</span> <span class="s">"airspec"</span> <span class="o">%</span> <span class="s">"(version)"</span> <span class="o">%</span> <span class="s">"test"</span>
<span class="n">testFrameworks</span> <span class="o">+=</span> <span class="k">new</span> <span class="nc">TestFramework</span><span class="o">(</span><span class="s">"wvlet.airspec.Framework"</span><span class="o">)</span>
</code></pre></div></div>

<h2 id="writing-unit-tests">Writing Unit Tests</h2>

<p>In AirSpec test cases are defined as functions in a class (or an object) extending <code class="highlighter-rouge">AirSpec</code>.
All <strong>public methods</strong> in the class will be executed as test cases:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">wvlet.airspec._</span>

<span class="k">class</span> <span class="nc">MyTest</span> <span class="k">extends</span> <span class="nc">AirSpec</span> <span class="o">{</span>
  <span class="c1">// Basic assertion
</span>  <span class="k">def</span> <span class="nf">emptySeqSizeShouldBe0</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
    <span class="nf">assert</span><span class="o">(</span><span class="nv">Seq</span><span class="o">.</span><span class="py">empty</span><span class="o">.</span><span class="py">size</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span>
  <span class="o">}</span>

  <span class="c1">// Catch an exception
</span>  <span class="k">def</span> <span class="nf">emptySeqHeadShouldFail</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
    <span class="n">intercept</span><span class="o">[</span><span class="kt">NoSuchElementException</span><span class="o">]{</span>
      <span class="nv">Seq</span><span class="o">.</span><span class="py">empty</span><span class="o">.</span><span class="py">head</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>If you need to define utility methods in a class, use private or protected scope.</p>

<h3 id="scalajs">Scala.js</h3>

<p>To use AirSpec in Scala.js, <code class="highlighter-rouge">scalaJsSupport</code> must be called inside your spec classes:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">wvlet.airspec._</span>

<span class="k">class</span> <span class="nc">ScalaJSSpec</span> <span class="k">extends</span> <span class="nc">AirSpec</span> <span class="o">{</span>
  <span class="c1">// This is necessary to find test methods in Scala.js
</span>  <span class="n">scalaJsSupport</span>

  <span class="k">def</span> <span class="nf">myTest</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="nf">assert</span><span class="o">(</span><span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>

<p>This is because Scala.js has no runtime reflection to find methods in AirSpec classes, so we need to provide method data by calling <code class="highlighter-rouge">scalaJsSupport</code>.
Internally this will generate <code class="highlighter-rouge">MethodSurface</code>s (airframe-surface), so that AirSpec can find test methods at runtime. Calling <code class="highlighter-rouge">scalaJsSupport</code> has no effect in Scala JVM platform, so you can use the same test spec both for Scala and Scala.js.</p>

<h2 id="writing-specs-in-natural-languages">Writing Specs In Natural Languages</h2>

<p>If you prefer natural language descriptions for your test cases, use symbols (back-quoted strings) for function names:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">wvlet.airspec._</span>

<span class="k">class</span> <span class="nc">SeqSpec</span> <span class="k">extends</span> <span class="nc">AirSpec</span> <span class="o">{</span>
  <span class="k">def</span> <span class="nf">`</span><span class="n">the</span> <span class="n">size</span> <span class="n">of</span> <span class="n">empty</span> <span class="nc">Seq</span> <span class="n">should</span> <span class="n">be</span> <span class="mi">0</span><span class="n">`: Unit = {
    assert(Seq.empty.size == 0)
  }

  // Catch an exception
  def `</span><span class="k">throw</span> <span class="nc">NoSuchElementException</span> <span class="n">when</span> <span class="n">taking</span> <span class="n">the</span> <span class="n">head</span> <span class="n">of</span> <span class="n">an</span> <span class="n">empty</span> <span class="nc">Set</span><span class="o">`:</span> <span class="nc">Unit</span> <span class="k">=</span> <span class="o">{</span>
    <span class="n">intercept</span><span class="o">[</span><span class="kt">NoSuchElementException</span><span class="o">]</span> <span class="o">{</span>
      <span class="nv">Seq</span><span class="o">.</span><span class="py">empty</span><span class="o">.</span><span class="py">head</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>It is also possible to use symbols for test class names:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">wvlet.airspec._</span>

<span class="k">class</span> <span class="nc">`Test</span> <span class="n">properties</span> <span class="n">of</span> <span class="nc">Seq</span><span class="o">[</span><span class="kt">X</span><span class="o">]</span><span class="n">` extends AirSpec {
  def `the</span> <span class="n">size</span> <span class="n">of</span> <span class="n">empty</span> <span class="nc">Seq</span> <span class="n">should</span> <span class="n">be</span> <span class="mi">0</span><span class="o">`:</span> <span class="nc">Unit</span> <span class="k">=</span> <span class="o">{</span>
    <span class="nf">assert</span><span class="o">(</span><span class="nv">Seq</span><span class="o">.</span><span class="py">empty</span><span class="o">.</span><span class="py">size</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="assertions-in-airspec">Assertions in AirSpec</h2>

<p>AirSpec supports basic assertions listed below:</p>

<table>
  <thead>
    <tr>
      <th><strong>syntax</strong></th>
      <th><strong>meaning</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>assert(x == y)</strong></td>
      <td>check x equals to y</td>
    </tr>
    <tr>
      <td><strong>assertEquals(a, b, delta)</strong></td>
      <td>check the equality of Float (or Double) values by allowing some delta difference</td>
    </tr>
    <tr>
      <td><strong>intercept[E] { … }</strong></td>
      <td>Catch an exception of type <code class="highlighter-rouge">E</code> to check an expected exception is thrown</td>
    </tr>
    <tr>
      <td><strong>x shouldBe y</strong></td>
      <td>check x == y. This supports matching collections like Seq, Array (with deepEqual)</td>
    </tr>
    <tr>
      <td><strong>x shouldNotBe y</strong></td>
      <td>check x != y</td>
    </tr>
    <tr>
      <td><strong>x shouldNotBe null</strong></td>
      <td>shouldBe, shouldNotBe supports null check</td>
    </tr>
    <tr>
      <td><strong>x shouldBe defined</strong></td>
      <td>check x.isDefined == true, when x is Option or Seq</td>
    </tr>
    <tr>
      <td><strong>x shouldBe empty</strong></td>
      <td>check x.isEmpty == true, when x is Option or Seq</td>
    </tr>
    <tr>
      <td><strong>x shouldBeTheSameInstanceAs y</strong></td>
      <td>check x eq y; x and y are the same object instance</td>
    </tr>
    <tr>
      <td><strong>x shouldNotBeTheSameInstanceAs y</strong></td>
      <td>check x ne y; x and y should not be the same instance</td>
    </tr>
    <tr>
      <td><strong>fail(“reason”)</strong></td>
      <td>fail the test if this code path should not be reached</td>
    </tr>
    <tr>
      <td><strong>ignore(“reason”)</strong></td>
      <td>ignore this test execution.</td>
    </tr>
    <tr>
      <td><strong>cancel(“reason”)</strong></td>
      <td>cancel the test (e.g., due to set up failure)</td>
    </tr>
    <tr>
      <td><strong>pending</strong></td>
      <td>pending the test execution (e.g., when hitting an unknown issue)</td>
    </tr>
    <tr>
      <td><strong>pendingUntil(“reason”)</strong></td>
      <td>pending until fixing some blocking issues</td>
    </tr>
    <tr>
      <td><strong>skip(“reason”)</strong></td>
      <td>Skipping unnecessary tests (e.g., tests that cannot be supported in Scala.js)</td>
    </tr>
  </tbody>
</table>

<p>Tests in AirSpec are just regular functions in Scala. AirSpec is designed to use pure Scala syntax as much as possible so as not to introduce any complex DSLs, which are usually hard to remember.</p>

<h3 id="examples">Examples</h3>

<p>Here are examples of using <code class="highlighter-rouge">shouldBe</code> matchers:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">wvlet.airspec._</span>

<span class="k">class</span> <span class="nc">MyTest</span> <span class="k">extends</span> <span class="nc">AirSpec</span> <span class="o">{</span>
  <span class="k">def</span> <span class="nf">test</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
    <span class="c1">// checking the value equality with shouldBe, shouldNotBe:
</span>    <span class="mi">1</span> <span class="n">shouldBe</span> <span class="mi">1</span>
    <span class="mi">1</span> <span class="n">shouldNotBe</span> <span class="mi">2</span>
    <span class="nc">List</span><span class="o">().</span><span class="py">isEmpty</span> <span class="n">shouldBe</span> <span class="kc">true</span>

    <span class="c1">// For optional values, shouldBe defined (or empty) can be used:
</span>    <span class="nc">Option</span><span class="o">(</span><span class="s">"hello"</span><span class="o">)</span> <span class="n">shouldBe</span> <span class="n">defined</span>
    <span class="nc">Option</span><span class="o">(</span><span class="kc">null</span><span class="o">)</span> <span class="n">shouldBe</span> <span class="n">empty</span>
    <span class="nc">None</span> <span class="n">shouldNotBe</span> <span class="n">defined</span>

    <span class="c1">// null check
</span>    <span class="k">val</span> <span class="nv">s</span><span class="k">:</span><span class="kt">String</span> <span class="o">=</span> <span class="kc">null</span>
    <span class="n">s</span> <span class="n">shouldBe</span> <span class="kc">null</span>
    <span class="s">"s"</span> <span class="n">shouldNotBe</span> <span class="kc">null</span>

    <span class="c1">// For Arrays, shouldBe checks the equality with deep equals
</span>    <span class="nc">Array</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">)</span> <span class="n">shouldBe</span> <span class="nc">Array</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">)</span>

    <span class="c1">// Collection checker 
</span>    <span class="nc">Seq</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="n">shouldBe</span> <span class="n">defined</span>
    <span class="nc">Seq</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="n">shouldNotBe</span> <span class="n">empty</span>
    <span class="nc">Seq</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">)</span> <span class="n">shouldBe</span> <span class="nc">Seq</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">)</span>
    <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="sc">'a'</span><span class="o">)</span> <span class="nf">shouldBe</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="sc">'a'</span><span class="o">)</span>

    <span class="c1">// Object equality checker
</span>    <span class="k">val</span> <span class="nv">a</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">)</span>
    <span class="k">val</span> <span class="nv">a1</span> <span class="k">=</span> <span class="n">a</span>
    <span class="k">val</span> <span class="nv">b</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">)</span>
    <span class="n">a</span> <span class="n">shouldBe</span> <span class="n">a1</span>
    <span class="n">a</span> <span class="n">shouldBeTheSameInstanceAs</span> <span class="n">a1</span>
    <span class="n">a</span> <span class="n">shouldBe</span> <span class="n">b</span>
    <span class="n">a</span> <span class="n">shouldNotBeTheSameInstanceAs</span> <span class="n">b</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="running-tests-in-sbt">Running Tests in sbt</h2>

<p>AirSpec supports pattern matching for running only specific tests:</p>
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">$</span> <span class="n">sbt</span>

<span class="o">&gt;</span> <span class="n">test</span>                                   <span class="k">#</span> <span class="nc">Run</span> <span class="n">all</span> <span class="n">tests</span>
<span class="o">&gt;</span> <span class="n">testOnly</span> <span class="o">--</span> <span class="o">(</span><span class="n">pattern</span><span class="o">)</span>                  <span class="k">#</span> <span class="nc">Run</span> <span class="n">all</span> <span class="n">test</span> <span class="n">matching</span> <span class="n">the</span> <span class="nf">pattern</span> <span class="o">(</span><span class="k">class</span> <span class="nc">name</span> <span class="n">or</span> <span class="n">test</span> <span class="n">name</span><span class="o">)</span>
<span class="o">&gt;</span> <span class="n">testOnly</span> <span class="o">--</span> <span class="o">(</span><span class="k">class</span> <span class="nc">pattern</span><span class="o">)*(</span><span class="n">pattern</span><span class="o">)</span>  <span class="k">#</span> <span class="nc">Search</span> <span class="n">both</span> <span class="k">class</span> <span class="nc">and</span> <span class="n">test</span> <span class="n">names</span>

<span class="k">#</span> <span class="n">sbt</span><span class="ss">'s </span><span class="n">default</span> <span class="n">test</span> <span class="n">functionalities</span><span class="k">:</span>
<span class="kt">&gt;</span> <span class="kt">testQuick</span>                              <span class="k">#</span> <span class="kt">Run</span> <span class="kt">only</span> <span class="kt">previously</span> <span class="kt">failed</span> <span class="kt">test</span> <span class="kt">specs</span>
<span class="o">&gt;</span> <span class="nf">testOnly</span> <span class="o">(</span><span class="k">class</span> <span class="nc">name</span><span class="o">)</span>                  <span class="k">#</span> <span class="nc">Run</span> <span class="n">tests</span> <span class="n">only</span> <span class="n">in</span> <span class="n">specific</span> <span class="n">classes</span> <span class="n">matching</span> <span class="n">a</span> <span class="nf">pattern</span> <span class="o">(</span><span class="n">wildcard</span> <span class="n">is</span> <span class="n">supported</span><span class="o">)</span> 
</code></pre></div></div>

<p><code class="highlighter-rouge">pattern</code> is used for partial matching with test names. It also supports wildcard (<code class="highlighter-rouge">*</code>) and regular expressions (experimental).
Basically AirSpec will find matches from the list of all <code class="highlighter-rouge">(test class full name):(test function name)</code> strings.
Cases of test names will be ignored in the search.</p>

<p><img src="https://wvlet.org/airframe/img/airspec/airspec.png" alt="image" /></p>

<h3 id="disable-parallel-test-execution">Disable Parallel Test Execution</h3>

<p>sbt 1.x or higher runs tests in parallel. This is fast, but it messes up console log messages.
If you prefer sequential test execution, set <code class="highlighter-rouge">parallelExecution in Test</code> to false:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">parallelExecution</span> <span class="n">in</span> <span class="nc">Test</span> <span class="o">:=</span> <span class="kc">false</span>
</code></pre></div></div>

<h2 id="logging-your-tests">Logging Your Tests</h2>

<p>To debug your tests, showing console logs with <code class="highlighter-rouge">info</code>, <code class="highlighter-rouge">debug</code>, <code class="highlighter-rouge">trace</code>, <code class="highlighter-rouge">warn</code>, <code class="highlighter-rouge">error</code> functions will be useful. AirSpec is integrated with <a href="https://wvlet.org/airframe/docs/airframe-log.html">airframe-log</a> to support handly logging messages with these functions.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">wvlet.airspec._</span>

<span class="k">package</span> <span class="nn">org.mydomain.myapp</span>

<span class="k">class</span> <span class="nc">MyTest</span> <span class="k">extends</span> <span class="nc">AirSpec</span> <span class="o">{</span>
  <span class="nf">info</span><span class="o">(</span><span class="n">s</span><span class="s">"info log"</span><span class="o">)</span>
  <span class="nf">debug</span><span class="o">(</span><span class="n">s</span><span class="s">"debug log"</span><span class="o">)</span> <span class="c1">// Will not be shown by default 
</span>  <span class="nf">trace</span><span class="o">(</span><span class="n">s</span><span class="s">"trace log"</span><span class="o">)</span> <span class="c1">// To show this level of log, trace log level must be set
</span><span class="o">}</span>
</code></pre></div></div>

<p>Similarly, if you include <code class="highlighter-rouge">wvlet.log.LogSupport</code> to your application classes, you can add log messages to these classes.</p>

<h3 id="changing-log-levels">Changing Log Levels</h3>

<p>To change the log level for your packages and classes, add <em>log-test.properties</em> file to your test resource folder <code class="highlighter-rouge">src/test/resources</code>. For multi-module projects, put this file under <code class="highlighter-rouge">(project folder)/src/test/resources</code> folder.</p>

<p>This is an example of changing log levels of your packages and classes:</p>

<p><strong>src/test/resources/log-test.properties</strong></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Log level configuration examples
# Show debug logs of all classes in org.mydomain.myapp package 
org.mydomain.myapp=debug
# Show  
org.mydomain.myapp.MyTest=trace
</code></pre></div></div>

<p>As you modify this property file, a background thread automatically reads this log file and refreshes the log level accordingly.</p>

<p>For more details, see the <a href="https://wvlet.org/airframe/docs/airframe-log.html">documentation</a> of airframe-log.</p>

<h2 id="dependency-injection-with-airframe-di">Dependency Injection with Airframe DI</h2>

<p>AirSpec can pass shared objects to your test cases by using function arguments.
This is useful for sharing objects initialized only once at the beginning with test cases.</p>

<h3 id="global-and-local-sessions">Global and Local Sessions</h3>

<p>AirSpec manages two types of sessions: <em>global</em> and <em>local</em>:</p>
<ul>
  <li>For each AirSpec instance, a single global session will be created.</li>
  <li>For each test method in the AirSpec instance, a local (child) session that inherits the global session will be created.</li>
</ul>

<p>To configure the design of objects that will be created in each session,
override <code class="highlighter-rouge">protected def design:Design</code> or <code class="highlighter-rouge">protected def localDesign: Design</code> methods in AirSpec.</p>

<h3 id="session-lifecycle">Session LifeCycle</h3>

<p>AirSpec manages global/local sessions in this order:</p>

<ul>
  <li>Create a new instance of AirSpec
    <ul>
      <li>Run <code class="highlighter-rouge">beforeAll</code></li>
      <li>Call <code class="highlighter-rouge">design</code> to prepare a new global design</li>
      <li>Start a new global session
        <ul>
          <li>for each test method <em>m</em>:
            <ul>
              <li>Call <code class="highlighter-rouge">before</code></li>
              <li>Call <code class="highlighter-rouge">localDesign</code> to prepare a new local design</li>
              <li>Start a new local session
                <ul>
                  <li>Call the test method <em>m</em> by building method arguments using the local session (and the global session). See also <a href="https://wvlet.org/airframe/docs/airframe.html#child-sessions">Airframe DI: Child Sessions</a> to learn more about the dependency resolution order.</li>
                </ul>
              </li>
              <li>Shutdown the local session. All data in the local session will be discarded</li>
              <li>Call <code class="highlighter-rouge">after</code></li>
            </ul>
          </li>
          <li>Repeat the loop</li>
        </ul>
      </li>
      <li>Shutdown the global session. All data in the global session will be discarded.</li>
      <li>Call <code class="highlighter-rouge">afterAll</code></li>
    </ul>
  </li>
</ul>

<h2 id="di-example">DI Example</h2>

<p>This is an example to utilize a global session to share the same service instance between test methods:</p>
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">wvlet.airspec._</span>
<span class="k">import</span> <span class="nn">wvlet.airframe._</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">ServiceConfig</span><span class="o">(</span><span class="n">port</span><span class="k">:</span><span class="kt">Int</span><span class="o">)</span>
<span class="k">class</span> <span class="nc">Service</span><span class="o">(</span><span class="k">val</span> <span class="nv">config</span><span class="k">:</span><span class="kt">ServiceConfig</span><span class="o">)</span>

<span class="k">class</span> <span class="nc">ServiceSpec</span> <span class="k">extends</span> <span class="nc">AirSpec</span> <span class="o">{</span>
  <span class="k">override</span> <span class="k">protected</span> <span class="k">def</span> <span class="nf">design</span><span class="k">:</span> <span class="kt">Design</span> <span class="o">=</span> <span class="o">{</span>
    <span class="n">newDesign</span>
      <span class="o">.</span><span class="py">bind</span><span class="o">[</span><span class="kt">ServiceConfig</span><span class="o">].</span><span class="py">toInstance</span><span class="o">(</span><span class="nc">ServiceConfig</span><span class="o">(</span><span class="n">port</span><span class="k">=</span><span class="mi">8080</span><span class="o">))</span>
      <span class="o">.</span><span class="py">bind</span><span class="o">[</span><span class="kt">Service</span><span class="o">].</span><span class="py">toSingleton</span>
      <span class="o">.</span><span class="py">onStart</span><span class="o">{</span><span class="n">x</span> <span class="k">=&gt;</span> <span class="nf">info</span><span class="o">(</span><span class="n">s</span><span class="s">"Starting a server at ${x.config.port}"</span><span class="o">)}</span>
      <span class="o">.</span><span class="py">onShutdown</span><span class="o">{</span><span class="n">x</span> <span class="k">=&gt;</span> <span class="nf">info</span><span class="o">(</span><span class="n">s</span><span class="s">"Stopping the server at ${x.config.port}"</span><span class="o">)}</span>
  <span class="o">}</span>

  <span class="k">def</span> <span class="nf">test1</span><span class="o">(</span><span class="n">service</span><span class="k">:</span><span class="kt">Service</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
     <span class="nf">info</span><span class="o">(</span><span class="n">s</span><span class="s">"server id: ${service.hashCode}"</span><span class="o">)</span>
  <span class="o">}</span>

  <span class="k">def</span> <span class="nf">test2</span><span class="o">(</span><span class="n">service</span><span class="k">:</span><span class="kt">Service</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
     <span class="nf">info</span><span class="o">(</span><span class="n">s</span><span class="s">"server id: ${service.hashCode}"</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>This test shares the same Service instance between two test methods <code class="highlighter-rouge">test1</code> and <code class="highlighter-rouge">test2</code>, and properly start and closes the service before and after running tests.</p>
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="n">testOnly</span> <span class="o">--</span> <span class="nc">ServiceSpec</span>
<span class="mi">2019</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">09</span> <span class="mi">17</span><span class="k">:</span><span class="err">24</span><span class="kt">:</span><span class="err">37</span><span class="kt">.</span><span class="err">184</span><span class="kt">-</span><span class="err">0700</span>  <span class="kt">info</span> <span class="o">[</span><span class="kt">ServiceSpec</span><span class="o">]</span> <span class="nc">Starting</span> <span class="n">a</span> <span class="n">server</span> <span class="n">at</span> <span class="mi">8080</span>  <span class="o">-</span> <span class="o">(</span><span class="nv">ServiceSpec</span><span class="o">.</span><span class="py">scala</span><span class="k">:</span><span class="err">33</span><span class="o">)</span>
<span class="mi">2019</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">09</span> <span class="mi">17</span><span class="k">:</span><span class="err">24</span><span class="kt">:</span><span class="err">37</span><span class="kt">.</span><span class="err">188</span><span class="kt">-</span><span class="err">0700</span>  <span class="kt">info</span> <span class="o">[</span><span class="kt">ServiceSpec</span><span class="o">]</span> <span class="n">test1</span><span class="k">:</span> <span class="kt">server</span> <span class="kt">id:</span> <span class="err">588474577</span>  <span class="kt">-</span> <span class="o">(</span><span class="kt">ServiceSpec.scala:</span><span class="err">42</span><span class="o">)</span>
<span class="err">2019</span><span class="kt">-</span><span class="err">08</span><span class="kt">-</span><span class="err">09</span> <span class="err">17</span><span class="kt">:</span><span class="err">24</span><span class="kt">:</span><span class="err">37</span><span class="kt">.</span><span class="err">193</span><span class="kt">-</span><span class="err">0700</span>  <span class="kt">info</span> <span class="o">[</span><span class="kt">ServiceSpec</span><span class="o">]</span> <span class="n">test2</span><span class="k">:</span> <span class="kt">server</span> <span class="kt">id:</span> <span class="err">588474577</span>  <span class="kt">-</span> <span class="o">(</span><span class="kt">ServiceSpec.scala:</span><span class="err">46</span><span class="o">)</span>
<span class="err">2019</span><span class="kt">-</span><span class="err">08</span><span class="kt">-</span><span class="err">09</span> <span class="err">17</span><span class="kt">:</span><span class="err">24</span><span class="kt">:</span><span class="err">37</span><span class="kt">.</span><span class="err">194</span><span class="kt">-</span><span class="err">0700</span>  <span class="kt">info</span> <span class="o">[</span><span class="kt">ServiceSpec</span><span class="o">]</span> <span class="nc">Stopping</span> <span class="n">the</span> <span class="n">server</span> <span class="n">at</span> <span class="mi">8080</span>  <span class="o">-</span> <span class="o">(</span><span class="nv">ServiceSpec</span><span class="o">.</span><span class="py">scala</span><span class="k">:</span><span class="err">34</span><span class="o">)</span>
<span class="o">[</span><span class="kt">info</span><span class="o">]</span> <span class="nc">ServiceSpec</span><span class="k">:</span>
<span class="err">[</span><span class="kt">info</span><span class="err">]</span>  <span class="kt">-</span> <span class="kt">test1</span> <span class="err">13</span><span class="kt">.</span><span class="err">94</span><span class="kt">ms</span>
<span class="o">[</span><span class="kt">info</span><span class="o">]</span>  <span class="o">-</span> <span class="n">test2</span> <span class="mf">403.41</span><span class="n">us</span>
<span class="o">[</span><span class="kt">info</span><span class="o">]</span> <span class="nc">Passed</span><span class="k">:</span> <span class="kt">Total</span> <span class="err">2</span><span class="o">,</span> <span class="nc">Failed</span> <span class="mi">0</span><span class="o">,</span> <span class="nc">Errors</span> <span class="mi">0</span><span class="o">,</span> <span class="nc">Passed</span> <span class="mi">2</span>
</code></pre></div></div>

<h3 id="overriding-design-at-test-methods">Overriding Design At Test Methods</h3>

<p>If you need a partially different design in a test method, pass Airframe <code class="highlighter-rouge">Session</code> to the test method arguments, and call <code class="highlighter-rouge">session.withChildSession(additional_design)</code>:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">wvlet.airspec._</span>
<span class="k">import</span> <span class="nn">wvlet.airframe._</span>

<span class="k">class</span> <span class="nc">OverrideTest</span> <span class="k">extends</span> <span class="nc">AirSpec</span> <span class="o">{</span>

  <span class="k">override</span> <span class="k">protected</span> <span class="k">def</span> <span class="nf">design</span><span class="k">:</span> <span class="kt">Design</span> <span class="o">=</span> <span class="o">{</span>
    <span class="n">newDesign</span>
      <span class="o">.</span><span class="py">bind</span><span class="o">[</span><span class="kt">String</span><span class="o">].</span><span class="py">toInstance</span><span class="o">(</span><span class="s">"hello"</span><span class="o">)</span>
  <span class="o">}</span>
 
  <span class="c1">// Pass Session to override the design
</span>  <span class="k">def</span> <span class="nf">overrideDesign</span><span class="o">(</span><span class="n">session</span><span class="k">:</span> <span class="kt">Session</span><span class="o">,</span> <span class="n">s</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
    <span class="n">s</span> <span class="n">shouldBe</span> <span class="s">"hello"</span>
  
    <span class="c1">// Override a design
</span>    <span class="k">val</span> <span class="nv">d</span> <span class="k">=</span> <span class="n">newDesign</span>
      <span class="o">.</span><span class="py">bind</span><span class="o">[</span><span class="kt">String</span><span class="o">].</span><span class="py">toInstance</span><span class="o">(</span><span class="s">"hello child"</span><span class="o">)</span>
   
    <span class="c1">// Create a new child session
</span>    <span class="nv">session</span><span class="o">.</span><span class="py">withChildSession</span><span class="o">(</span><span class="n">d</span><span class="o">)</span> <span class="o">{</span> <span class="n">childSession</span> <span class="k">=&gt;</span>
      <span class="k">val</span> <span class="nv">cs</span> <span class="k">=</span> <span class="nv">childSession</span><span class="o">.</span><span class="py">build</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span>
      <span class="n">cs</span> <span class="n">shouldBe</span> <span class="s">"hello child"</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<h3 id="pro-tips">Pro Tips</h3>

<p>Designs of Airframe DI are useful for defining modules of your application.
If you need to switch some implementations or configurations for your tests, override your design as shown below:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">wvlet.airframe._</span>

<span class="k">object</span> <span class="nc">AppModule</span> <span class="o">{</span>
  <span class="c1">// Define your application design
</span>  <span class="k">def</span> <span class="nf">serviceDesign</span><span class="k">:</span> <span class="kt">Design</span> <span class="o">=</span> <span class="o">{</span>
    <span class="n">newDesign</span>
        <span class="o">.</span><span class="py">bind</span><span class="o">[</span><span class="kt">Service</span><span class="o">].</span><span class="py">to</span><span class="o">[</span><span class="kt">ServiceImpl</span><span class="o">]</span>
        <span class="o">.</span><span class="py">bind</span><span class="o">[</span><span class="kt">ServiceConfig</span><span class="o">].</span><span class="py">toInstance</span><span class="o">(</span><span class="k">new</span> <span class="nc">ServiceConfig</span><span class="o">(...))</span>
  <span class="o">}</span>

  <span class="c1">// Define designs of other compoments as you need
</span>  <span class="k">def</span> <span class="nf">componentDesign</span><span class="k">:</span> <span class="kt">Design</span> <span class="o">=</span> <span class="o">...</span>
<span class="o">}</span>

<span class="c1">// Design for testing
</span><span class="k">object</span> <span class="nc">AppTestModule</span> <span class="o">{</span>
  <span class="k">def</span> <span class="nf">serviceDesignForTests</span><span class="k">:</span> <span class="kt">Design</span> <span class="o">=</span> <span class="o">{</span>
    <span class="nv">AppModule</span><span class="o">.</span><span class="py">serviceDesign</span>  <span class="c1">// Reuse your application design for tests
</span>     <span class="o">.</span><span class="py">bind</span><span class="o">[</span><span class="kt">ServiceConfig</span><span class="o">].</span><span class="py">toInstnce</span><span class="o">(</span><span class="k">new</span> <span class="nc">ServiceConfig</span><span class="o">(...))</span> <span class="c1">// Override the config for tests
</span>  <span class="o">}</span>
<span class="o">}</span>

<span class="k">import</span> <span class="nn">wvlet.airspec._</span>
<span class="k">class</span> <span class="nc">AppTest</span> <span class="k">extends</span> <span class="nc">AirSpec</span> <span class="o">{</span>
  <span class="c1">// Use the testing design
</span>  <span class="k">protected</span> <span class="k">override</span> <span class="k">def</span> <span class="nf">design</span> <span class="k">=</span> <span class="nv">AppTestModule</span><span class="o">.</span><span class="py">serviceDesignForTests</span>

  <span class="c1">// Inject a Service object initialized with a test configuration
</span>  <span class="k">def</span> <span class="nf">`</span><span class="n">start</span> <span class="n">up</span> <span class="n">test</span><span class="o">`(</span><span class="n">service</span><span class="k">:</span><span class="kt">Service</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
     <span class="c1">// test your service here
</span>  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>If you are already familiar to dependency injection using <a href="https://wvlet.org/airframe/docs/airframe.html">Airframe DI</a> or <a href="https://github.com/google/guice">Google Guice</a>, it would not be so difficult to split your application into some units of testable modules.
 This is generally a good practice to minimize the scope of tests only for specific components.</p>

<h2 id="reusing-test-classes">Reusing Test Classes</h2>

<p>To reuse test cases, create a fixture, which is a class, object, or trait extending
AirSpec. Then call AirSpecContext.run(AirSpec instance), which can be injected to test method arguments:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">wvlet.airspec._</span>

<span class="k">class</span> <span class="nc">MySpec</span> <span class="k">extends</span> <span class="nc">AirSpec</span> <span class="o">{</span>
  <span class="c1">// A template for reusable test cases
</span>  <span class="k">class</span> <span class="nc">Fixture</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">data</span><span class="k">:</span> <span class="kt">Seq</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span> <span class="k">extends</span> <span class="nc">AirSpec</span> <span class="o">{</span>
    <span class="k">override</span> <span class="k">protected</span> <span class="k">def</span> <span class="nf">beforeAll</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
      <span class="nf">info</span><span class="o">(</span><span class="n">s</span><span class="s">"Run tests for ${data}"</span><span class="o">)</span>
    <span class="o">}</span>
    <span class="k">def</span> <span class="nf">emptyTest</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
      <span class="n">data</span> <span class="n">shouldNotBe</span> <span class="n">empty</span>
    <span class="o">}</span>
    <span class="k">def</span> <span class="nf">sizeTest</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
      <span class="nv">data</span><span class="o">.</span><span class="py">length</span> <span class="n">shouldBe</span> <span class="nv">data</span><span class="o">.</span><span class="py">size</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="c1">// Inject AirSpecContext using DI
</span>  <span class="k">def</span> <span class="nf">test</span><span class="o">(</span><span class="n">context</span><span class="k">:</span> <span class="kt">AirSpecContext</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
    <span class="nv">context</span><span class="o">.</span><span class="py">run</span><span class="o">(</span><span class="k">new</span> <span class="nc">Fixture</span><span class="o">(</span><span class="nc">Seq</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">)))</span>
    <span class="nv">context</span><span class="o">.</span><span class="py">run</span><span class="o">(</span><span class="k">new</span> <span class="nc">Fixture</span><span class="o">(</span><span class="nc">Seq</span><span class="o">(</span><span class="s">"A"</span><span class="o">,</span> <span class="s">"B"</span><span class="o">,</span> <span class="s">"C"</span><span class="o">)))</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>This code will run the same Fixture two times using different data sets:
<img src="https://wvlet.org/airframe/img/airspec/nesting.png" alt="image" /></p>

<p>AirSpecContext also contains the name of test classes and method names, which would be useful to know which tests are currently running.</p>

<h2 id="property-based-testing-with-scalacheck">Property Based Testing with ScalaCheck</h2>

<p>Optionally AirSpec can integrate with <a href="https://github.com/typelevel/scalacheck/blob/master/doc/UserGuide.md">ScalaCheck</a>.
Add <code class="highlighter-rouge">wvlet.airspec.spi.PropertyCheck</code> trait to your spec, and use <code class="highlighter-rouge">forAll</code> methods.</p>

<p><strong>build.sbt</strong></p>
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Use %%% for Scala.js
</span><span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="s">"org.scalacheck"</span> <span class="o">%%</span> <span class="s">"scalacheck"</span> <span class="o">%</span> <span class="s">"1.14.1"</span> <span class="o">%</span> <span class="s">"test"</span>
</code></pre></div></div>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">wvlet.airspec._</span>

<span class="k">class</span> <span class="nc">PropertyBasedTest</span> <span class="k">extends</span> <span class="nc">AirSpec</span> <span class="k">with</span> <span class="nc">PropertyCheck</span> <span class="o">{</span>
  <span class="k">def</span> <span class="nf">testAllInt</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
    <span class="n">forAll</span><span class="o">{</span> <span class="n">i</span><span class="k">:</span><span class="kt">Int</span> <span class="o">=&gt;</span> <span class="nv">i</span><span class="o">.</span><span class="py">isValidInt</span> <span class="n">shouldBe</span> <span class="kc">true</span> <span class="o">}</span>
  <span class="o">}</span>

  <span class="k">def</span> <span class="nf">testCommutativity</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
    <span class="n">forAll</span><span class="o">{</span> <span class="o">(</span><span class="n">x</span><span class="k">:</span><span class="kt">Int</span><span class="o">,</span> <span class="n">y</span><span class="k">:</span><span class="kt">Int</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span> <span class="o">==</span> <span class="n">y</span><span class="o">+</span><span class="n">x</span> <span class="o">}</span>
  <span class="o">}</span>

  <span class="c1">// Using custom genrators of ScalaCheck
</span>  <span class="k">def</span> <span class="nf">useGenerator</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
    <span class="k">import</span> <span class="nn">org.scalacheck.Gen</span>
    <span class="nf">forAll</span><span class="o">(</span><span class="nv">Gen</span><span class="o">.</span><span class="py">posNum</span><span class="o">[</span><span class="kt">Long</span><span class="o">]){</span> <span class="n">x</span><span class="k">:</span> <span class="kt">Long</span> <span class="o">=&gt;</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="n">shouldBe</span> <span class="kc">true</span> <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/airframe/highlight/highlight.pack.js"></script><script>hljs.configure({languages:['scala','java','bash']});
hljs.initHighlightingOnLoad();
              </script><script>console.info('\x57\x65\x62\x73\x69\x74\x65\x20\x62\x75\x69\x6c\x74\x20\x77\x69\x74\x68\x3a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x5f\x5f\x0a\x20\x20\x20\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x5f\x20\x20\x2f\x20\x2f\x5f\x20\x20\x20\x20\x20\x20\x5f\x5f\x5f\x5f\x20\x5f\x5f\x5f\x20\x20\x28\x5f\x29\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x28\x5f\x29\x20\x2f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x0a\x20\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x60\x5f\x5f\x20\x5c\x2f\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x20\x2f\x20\x5f\x5f\x2f\x20\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x0a\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x5f\x2f\x20\x2f\x20\x2f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x5f\x5f\x2f\x20\x2f\x20\x20\x2f\x20\x2f\x5f\x2f\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x20\x2f\x5f\x2f\x20\x20\x5f\x5f\x28\x5f\x5f\x20\x20\x29\x0a\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2e\x5f\x5f\x5f\x2f\x5c\x5f\x5f\x2f\x20\x20\x20\x20\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x2f\x20\x20\x20\x5c\x5f\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x0a\x0a\x68\x74\x74\x70\x73\x3a\x2f\x2f\x34\x37\x64\x65\x67\x2e\x67\x69\x74\x68\x75\x62\x2e\x69\x6f\x2f\x73\x62\x74\x2d\x6d\x69\x63\x72\x6f\x73\x69\x74\x65\x73')</script><script>((window.gitter = {}).chat = {}).options = {
room: 'wvlet/airframe'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/airframe/js/main.js"></script></body></html>