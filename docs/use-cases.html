<html><head><title>Airframe: Use Cases</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Taro L. Saito" /><meta name="description" content="Lightweight Building Blocks for Scala" /><meta name="og:image" content="/airframe/img/poster.png" /><meta name="image" property="og:image" content="/airframe/img/poster.png" /><meta name="og:title" content="Airframe: Use Cases" /><meta name="title" property="og:title" content="Airframe: Use Cases" /><meta name="og:site_name" content="Airframe" /><meta name="og:url" content="" /><meta name="og:type" content="website" /><meta name="og:description" content="Lightweight Building Blocks for Scala" /><link rel="icon" type="image/png" href="/airframe/img/favicon.png" /><meta name="twitter:title" content="Airframe: Use Cases" /><meta name="twitter:image" content="https://wvlet.org/airframe/img/poster.png" /><meta name="twitter:description" content="Lightweight Building Blocks for Scala" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/airframe/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/airframe/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/airframe/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/airframe/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/airframe/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/airframe/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/airframe/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/airframe/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/airframe/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/airframe/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/airframe/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/airframe/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/airframe/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/airframe/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/airframe/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/airframe/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/airframe/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/airframe/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/airframe/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/airframe/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/airframe/highlight/styles/ocean.css" /><link rel="stylesheet" href="/airframe/css/pattern-style.css" /><link rel="stylesheet" href="/airframe/css/overwrite.css" /><link rel="stylesheet" href="/airframe/css/solarized-dark.css" /><script async="async">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-98364158-1' , 'auto');
ga('send', 'pageview');
      </script></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/airframe/" class="brand"><div class="brand-wrapper"><span>Airframe</span></div></a></li> <li><a href="/airframe/docs/index.html" class="">Airframe Overview</a></li> <li><a href="/airframe/docs/release-notes.html" class="">Release Notes</a></li> <li><a href="/airframe/docs/airframe.html" class="">Airframe DI</a> <ul class="sub-section"> <li><a href="/airframe/docs/airframe.html#bind" class="">Bind</a></li> <li><a href="/airframe/docs/airframe.html#design" class="">Design</a></li> <li><a href="/airframe/docs/airframe.html#session" class="">Session</a></li> <li><a href="/airframe/docs/airframe.html#life-cycle" class="">Life Cycle</a></li> <li><a href="/airframe/docs/use-cases.html" class=" active ">Use Cases</a></li> <li><a href="/airframe/docs/bindings.html" class="">Advanced Binding Types</a></li> <li><a href="/airframe/docs/debug.html" class="">Debugging DI</a></li> <li><a href="/airframe/docs/comparison.html" class="">DI Framework Comparison</a></li> <li><a href="/airframe/docs/internals.html" class="">Airframe Internals</a></li></ul></li> <li><a href="/airframe/docs/airspec.html" class="">AirSpec Testing Framework</a></li> <li><a href="/airframe/docs/index.html" class="">Airframe Modules</a> <ul class="sub-section"> <li><a href="/airframe/docs/airframe-canvas.html" class="">airframe-canvas</a></li> <li><a href="/airframe/docs/airframe-codec.html" class="">airframe-codec</a></li> <li><a href="/airframe/docs/airframe-config.html" class="">airframe-config</a></li> <li><a href="/airframe/docs/airframe-control.html" class="">airframe-control</a></li> <li><a href="/airframe/docs/airframe-fluentd.html" class="">airframe-fluentd</a></li> <li><a href="/airframe/docs/airframe-http.html" class="">airframe-http</a></li> <li><a href="/airframe/docs/airframe-http-recorder.html" class="">airframe-http-recorder</a></li> <li><a href="/airframe/docs/airframe-jdbc.html" class="">airframe-jdbc</a></li> <li><a href="/airframe/docs/airframe-jmx.html" class="">airframe-jmx</a></li> <li><a href="/airframe/docs/airframe-json.html" class="">airframe-json</a></li> <li><a href="/airframe/docs/airframe-launcher.html" class="">airframe-launcher</a></li> <li><a href="/airframe/docs/airframe-log.html" class="">airframe-log</a></li> <li><a href="/airframe/docs/airframe-metrics.html" class="">airframe-metrics</a></li> <li><a href="/airframe/docs/airframe-msgpack.html" class="">airframe-msgpack</a></li> <li><a href="/airframe/docs/airframe-scalatest.html" class="">airframe-scalatest</a></li> <li><a href="/airframe/docs/airframe-surface.html" class="">airframe-surface</a></li> <li><a href="/airframe/docs/airframe-sql.html" class="">airframe-sql</a></li></ul></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/wvlet/airframe" target="_blank" rel="noopener noreferrer"><i class="fa fa-eye"></i><span>Watchers<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/wvlet/airframe" target="_blank" rel="noopener noreferrer"><i class="fa fa-star-o"></i><span>Stars<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('Airframe Lightweight Building Blocks for Scala');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('Airframe Lightweight Building Blocks for Scala');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="wvlet" data-github-repo="airframe"><div class="content-wrapper"><section><h1 id="use-cases">Use Cases</h1>

<p>This page illustrates typical use cases of Airframe.</p>

<ul>
  <li><a href="#configuring-applications">Configuring Applications</a></li>
  <li><a href="#managing-resources">Managing Resources</a></li>
  <li><a href="#factory-binding">Factory Binding</a></li>
  <li><a href="#service-mix-in">Service Mix-In</a></li>
  <li><a href="#override-bindings">Override Bindings</a></li>
</ul>

<h2 id="configuring-applications">Configuring Applications</h2>

<p>Configuring applications is cumbersome because you need to think about how to pass configurations to your classes. With Airframe this process becomes much simpler; Just binding configuration objects to your class:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">wvlet.airframe._</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">Config</span><span class="o">(</span><span class="n">host</span><span class="k">:</span><span class="kt">String</span><span class="o">,</span> <span class="n">port</span><span class="k">:</span><span class="kt">Int</span><span class="o">)</span>

<span class="k">trait</span> <span class="nc">App</span> <span class="o">{</span>
  <span class="c1">// bind configurations
</span>  <span class="k">private</span> <span class="k">val</span> <span class="nv">config</span> <span class="k">=</span> <span class="n">bind</span><span class="o">[</span><span class="kt">Config</span><span class="o">]</span>
  <span class="k">private</span> <span class="k">val</span> <span class="nv">server</span> <span class="k">=</span> <span class="n">bind</span><span class="o">[</span><span class="kt">Server</span><span class="o">]</span>

  <span class="k">def</span> <span class="nf">run</span> <span class="o">{</span>
    <span class="nv">sever</span><span class="o">.</span><span class="py">launch</span><span class="o">(</span><span class="nv">config</span><span class="o">.</span><span class="py">host</span><span class="o">,</span> <span class="nv">config</span><span class="o">.</span><span class="py">port</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Create a new design and add configuration
</span><span class="k">val</span> <span class="nv">d</span> <span class="k">=</span>
  <span class="n">newDesign</span>
  <span class="o">.</span><span class="py">bind</span><span class="o">[</span><span class="kt">Server</span><span class="o">].</span><span class="py">to</span><span class="o">[</span><span class="kt">YourServer</span><span class="o">]</span>
  <span class="o">.</span><span class="py">bind</span><span class="o">[</span><span class="kt">Config</span><span class="o">].</span><span class="py">toInstance</span><span class="o">(</span><span class="k">new</span> <span class="nc">Config</span><span class="o">(</span><span class="s">"localhost"</span><span class="o">,</span> <span class="mi">8080</span><span class="o">))</span>

<span class="c1">// Start the application
</span><span class="nv">d</span><span class="o">.</span><span class="py">withSession</span> <span class="o">{</span> <span class="n">session</span> <span class="k">=&gt;</span>
  <span class="k">val</span> <span class="nv">app</span> <span class="k">=</span> <span class="nv">session</span><span class="o">.</span><span class="py">build</span><span class="o">[</span><span class="kt">App</span><span class="o">]</span>
  <span class="nv">app</span><span class="o">.</span><span class="py">run</span>
<span class="o">}</span>
</code></pre></div></div>

<p>To change the configuration, you only need to add another binding because bindings to the same type object can be overwritten:</p>
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// You can override Config in your test code
</span><span class="k">val</span> <span class="nv">testDesign</span> <span class="k">=</span>
  <span class="nv">d</span><span class="o">.</span><span class="py">bind</span><span class="o">[</span><span class="kt">Config</span><span class="o">].</span><span class="py">toInstance</span><span class="o">(</span><span class="k">new</span> <span class="nc">Config</span><span class="o">(</span><span class="s">"localhost"</span><span class="o">,</span> <span class="n">randomPort</span><span class="o">))</span>
</code></pre></div></div>

<p>Airframe has a submodule called <a href="airframe-config.html">airframe-config</a>, which is useful for 
configuring your applications with YAML files.</p>

<h2 id="managing-resources">Managing Resources</h2>

<p>Airframe makes easier managing resources (e.g., network or database connections, thread managers, etc.) For example, if you are writing an application that requires an access to a database service. You need to establish a connection, and also need to properly close the connection after the application terminates. Airframe support such resource management using <a href="lifecicle.html">Life Cycle</a> triggers (onInit, onStart, onShutdown):</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">wvlet.airframe._</span>

<span class="k">trait</span> <span class="nc">DBService</span> <span class="o">{</span>
  <span class="k">private</span> <span class="k">val</span> <span class="nv">dbConfig</span> <span class="k">=</span> <span class="n">bind</span><span class="o">[</span><span class="kt">DBConfig</span><span class="o">]</span>
  <span class="k">private</span> <span class="k">val</span> <span class="nv">connection</span> <span class="k">=</span> <span class="n">bind</span><span class="o">[</span><span class="kt">DBConnection</span><span class="o">]</span>
    <span class="o">.</span><span class="py">onInit</span> <span class="o">{</span> <span class="n">c</span> <span class="k">=&gt;</span> <span class="nv">c</span><span class="o">.</span><span class="py">connect</span><span class="o">(</span><span class="nv">dbConfig</span><span class="o">.</span><span class="py">url</span><span class="o">,</span> <span class="nv">dbConfig</span><span class="o">.</span><span class="py">user</span><span class="o">,</span> <span class="o">...</span> <span class="o">)</span> <span class="o">}</span>
    <span class="o">.</span><span class="py">onShutdown</span> <span class="o">{</span>
      <span class="c1">// This will be executed when session.shutdown is called
</span>      <span class="n">c</span> <span class="k">=&gt;</span> <span class="nv">c</span><span class="o">.</span><span class="py">close</span>
    <span class="o">}</span>

  <span class="k">def</span> <span class="nf">query</span><span class="o">(</span><span class="n">sql</span><span class="k">:</span><span class="kt">String</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>
    <span class="nv">connection</span><span class="o">.</span><span class="py">query</span><span class="o">(</span><span class="n">sql</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Using DBService. This class has no need to care about closing DB
// connection resources because DBService will take care of it.
</span><span class="k">trait</span> <span class="nc">App</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">dbService</span> <span class="k">=</span> <span class="n">bind</span><span class="o">[</span><span class="kt">DBService</span><span class="o">]</span>

  <span class="nv">dbService</span><span class="o">.</span><span class="py">query</span><span class="o">(</span><span class="s">"select * from tbl"</span><span class="o">)</span>
<span class="o">}</span>

<span class="c1">// Your application launcher code
</span><span class="k">val</span> <span class="nv">d</span> <span class="k">=</span> <span class="n">newDesign</span>
  <span class="o">.</span><span class="py">bind</span><span class="o">[</span><span class="kt">DBService</span><span class="o">].</span><span class="py">toSingleton</span> <span class="c1">// To share the connection between classes
</span>  <span class="o">.</span><span class="py">bind</span><span class="o">[</span><span class="kt">DBConfig</span><span class="o">].</span><span class="py">toInstance</span><span class="o">(</span><span class="nc">DBConfig</span><span class="o">(</span><span class="s">"jdbc://..."</span><span class="o">,</span> <span class="s">"user name"</span><span class="o">,</span> <span class="o">...))</span>

<span class="nv">d</span><span class="o">.</span><span class="py">withSession</span> <span class="o">{</span> <span class="n">session</span> <span class="k">=&gt;</span>
  <span class="c1">// db connection will be established here
</span>  <span class="k">val</span> <span class="nv">app</span> <span class="k">=</span> <span class="nv">session</span><span class="o">.</span><span class="py">build</span><span class="o">[</span><span class="kt">App</span><span class="o">]</span>
<span class="o">}</span>
<span class="c1">// database connection will be closed automatically
</span>
</code></pre></div></div>

<h2 id="factory-binding">Factory Binding</h2>

<p>If you need to configure a service (e.g., port number of an web client), but you need to provide other dependencies from Airframe,
<code class="highlighter-rouge">bindFactory[I =&gt; A]</code> can be used.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">trait</span> <span class="nc">MyClient</span> <span class="o">{</span>
  <span class="k">private</span> <span class="k">val</span> <span class="nv">port</span> <span class="k">=</span> <span class="n">bind</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="c1">// This will be overwritten by the factory
</span>  <span class="k">private</span> <span class="k">val</span> <span class="nv">httpClientConfig</span> <span class="k">=</span> <span class="n">bind</span><span class="o">[</span><span class="kt">HttpClientConfig</span><span class="o">]</span> <span class="c1">// Use the shared instance 
</span>  <span class="k">private</span> <span class="k">val</span> <span class="nv">httpClient</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">HttpClient</span><span class="o">(</span><span class="n">port</span><span class="o">,</span> <span class="n">httpClientConfig</span><span class="o">)</span>
  
  <span class="nd">@PreDestroy</span>
  <span class="k">def</span> <span class="nf">stop</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
    <span class="nv">httpClient</span><span class="o">.</span><span class="py">close</span><span class="o">()</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="k">trait</span> <span class="nc">MyService</span> <span class="o">{</span>
  <span class="c1">// Create a factory Int =&gt; MyClient, which will override Int binding using a given parameter.
</span>  <span class="k">val</span> <span class="nv">clientFactory</span> <span class="k">=</span> <span class="n">bindFactory</span><span class="o">[</span><span class="kt">Int</span> <span class="k">=&gt;</span> <span class="kt">MyClient</span><span class="o">]</span>
<span class="o">}</span>


<span class="n">newDesign</span>
  <span class="o">.</span><span class="py">bind</span><span class="o">[</span><span class="kt">HttpClientConfig</span><span class="o">].</span><span class="py">toInstance</span><span class="o">(</span><span class="nc">HttpClientConfig</span><span class="o">(</span><span class="n">useSSL</span><span class="k">=</span><span class="kc">true</span><span class="o">,</span> <span class="n">timeoutSec</span><span class="k">=</span><span class="mi">60</span><span class="o">))</span>
  <span class="o">.</span><span class="py">build</span><span class="o">[</span><span class="kt">MyService</span><span class="o">]</span> <span class="o">{</span> <span class="n">s</span> <span class="k">=&gt;</span>
    <span class="k">val</span> <span class="nv">client1</span> <span class="k">=</span> <span class="nv">s</span><span class="o">.</span><span class="py">clientFactory</span><span class="o">(</span><span class="mi">8080</span><span class="o">)</span>
    <span class="k">val</span> <span class="nv">client2</span> <span class="k">=</span> <span class="nv">s</span><span class="o">.</span><span class="py">clientFactory</span><span class="o">(</span><span class="mi">8081</span><span class="o">)</span>
  <span class="o">}</span>
<span class="c1">// clients will be closed here
</span></code></pre></div></div>
<p>In this example, port number (Int) can be provided later when instantiating MyClient. 
HttpClientConfig instance can be shared between generated clients. 
You can also define lifecycle hooks to MyClient, which will be added for each generated instance of MyClient.</p>

<h2 id="service-mix-in">Service Mix-In</h2>

<p>A traditional way of building applications is passing necessary services to a main class:</p>
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">YourService</span><span class="o">(</span><span class="n">threadPool</span><span class="k">:</span><span class="kt">ThreadPool</span><span class="o">,</span> <span class="n">s1</span><span class="k">:</span><span class="kt">Service1</span><span class="o">,</span> <span class="n">s2</span><span class="k">:</span><span class="kt">Service2</span><span class="o">,</span> <span class="o">...)</span> <span class="o">{</span>
  <span class="o">...</span>
<span class="o">}</span>

<span class="k">val</span> <span class="nv">t</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ThreadPool</span>
<span class="k">val</span> <span class="nv">s1</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Service1</span><span class="o">(...)</span>
<span class="k">val</span> <span class="nv">s2</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Service2</span><span class="o">(...)</span>
<span class="o">...</span>
<span class="k">val</span> <span class="nv">service</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">YourService</span><span class="o">(</span><span class="n">t</span><span class="o">,</span> <span class="n">s1</span><span class="o">,</span> <span class="n">s2</span><span class="o">,</span> <span class="o">...)</span>
</code></pre></div></div>

<p>However, this approach is not scalable if you need to use more services in your class or if you need to implement applications that require different subsets of services.</p>

<p>If you write such services as <a href="http://docs.scala-lang.org/tutorials/tour/traits.html">traits</a> in Scala, it will be quite easy to compose applications that depends on many services. Here is an example of defining services using Airframe and Scala traits:</p>
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">wvlet.airframe._</span>

<span class="c1">// Define a thread pool functionality
</span><span class="k">trait</span> <span class="nc">ThreadPool</span> <span class="o">{</span>
  <span class="k">private</span> <span class="k">val</span> <span class="nv">executorService</span> <span class="k">=</span> <span class="n">bind</span><span class="o">[</span><span class="kt">ExecutorService</span><span class="o">]</span>
    <span class="o">.</span><span class="py">onShutdown</span><span class="o">{</span> <span class="nv">_</span><span class="o">.</span><span class="py">shutdown</span> <span class="o">}</span>

  <span class="k">def</span> <span class="nf">submit</span><span class="o">[</span><span class="kt">U</span><span class="o">](</span><span class="n">body</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="n">U</span><span class="o">)</span> <span class="o">{</span>
    <span class="nv">executorService</span><span class="o">.</span><span class="py">submit</span><span class="o">(</span><span class="k">new</span> <span class="nc">Runnable</span> <span class="o">{</span>
      <span class="k">def</span> <span class="nf">run</span> <span class="o">{</span> <span class="n">body</span> <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Instead of using constructor arguments,
// create a service trait that binds necessary service objects
</span><span class="k">trait</span> <span class="nc">ThreadPoolService</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">threadPool</span> <span class="k">=</span> <span class="n">bindSingleton</span><span class="o">[</span><span class="kt">ThreadPool</span><span class="o">]</span>
<span class="o">}</span>

<span class="c1">// Another service
</span><span class="k">trait</span> <span class="nc">MonitorService</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">monitor</span> <span class="k">=</span> <span class="n">bind</span><span class="o">[</span><span class="kt">Monitor</span><span class="o">]</span>
<span class="o">}</span>

<span class="c1">// Mix-in services
</span><span class="k">trait</span> <span class="nc">App1</span> <span class="k">extends</span> <span class="nc">ThreadPoolService</span> <span class="k">with</span> <span class="nc">MonitorService</span> <span class="o">{</span>
  <span class="nv">monitor</span><span class="o">.</span><span class="py">log</span><span class="o">(</span><span class="s">"starting app"</span><span class="o">)</span>
  <span class="nv">threadPool</span><span class="o">.</span><span class="py">submit</span><span class="o">(</span> <span class="o">...</span> <span class="o">)</span>
<span class="o">}</span>

<span class="c1">// Reuse singleton ThreadPool in another application
</span><span class="k">trait</span> <span class="nc">App2</span> <span class="k">extends</span> <span class="nc">ThreadPoolService</span> <span class="o">{</span>
  <span class="nv">threadPool</span><span class="o">.</span><span class="py">submit</span><span class="o">(</span> <span class="o">...</span> <span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>

<p>In general, you can create your application with Service mix-ins as below:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">trait</span> <span class="nc">YourApp</span>
 <span class="k">extends</span> <span class="nc">AService</span>
    <span class="k">with</span> <span class="nc">BService</span>
    <span class="k">with</span> <span class="nc">CDService</span>
    <span class="o">...</span>
    <span class="k">with</span> <span class="nc">ZService</span>
<span class="o">{</span>
  <span class="c1">// use a, b, c, d, .., z here
</span><span class="o">}</span>

<span class="k">trait</span> <span class="nc">AService</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">a</span> <span class="k">=</span> <span class="n">bind</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
<span class="o">}</span>

<span class="k">trait</span> <span class="nc">BService</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">b</span> <span class="k">=</span> <span class="n">bind</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span>
<span class="o">}</span>

<span class="k">trait</span> <span class="nc">CDService</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">c</span> <span class="k">=</span> <span class="n">bind</span><span class="o">[</span><span class="kt">C</span><span class="o">]</span>
  <span class="k">val</span> <span class="nv">d</span> <span class="k">=</span> <span class="n">bind</span><span class="o">[</span><span class="kt">D</span><span class="o">]</span>
<span class="o">}</span>
<span class="o">...</span>

</code></pre></div></div>

<h3 id="override-bindings">Override Bindings</h3>

<p>It is also possible to manually inject an instance implementation. This is useful for changing the behavior of objects for testing:</p>
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">trait</span> <span class="nc">CustomApp</span> <span class="k">extends</span> <span class="nc">App1</span> <span class="o">{</span>
  <span class="c1">// Manually inject an instance
</span>  <span class="k">override</span> <span class="k">val</span> <span class="nv">monitor</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MockMonitor</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>If you are using <a href="http://scalamock.org/">ScalaMock</a> or <a href="http://site.mockito.org/">Mockito</a>, you may overwrite a service with a mock (empty) implementation:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">trait</span> <span class="nc">MockApp</span> <span class="k">extends</span> <span class="nc">App1</span> <span class="o">{</span>
  <span class="k">override</span> <span class="k">val</span> <span class="nv">monitor</span> <span class="k">=</span> <span class="n">mock</span><span class="o">[</span><span class="kt">Monitor</span><span class="o">]</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Or you can use mock instance binding by extending the design:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="nv">coreDesign</span> <span class="k">=</span>
  <span class="n">newDesign</span>
  <span class="o">.</span><span class="py">bind</span><span class="o">[</span><span class="kt">Monitor</span><span class="o">].</span><span class="py">to</span><span class="o">[</span><span class="kt">MonitorImpl</span><span class="o">]</span>

<span class="k">val</span> <span class="nv">testDesign</span> <span class="k">=</span>
  <span class="n">coreDesign</span>
  <span class="o">.</span><span class="py">bind</span><span class="o">[</span><span class="kt">Monitor</span><span class="o">].</span><span class="py">toInstance</span><span class="o">(</span><span class="n">mock</span><span class="o">[</span><span class="kt">Monitor</span><span class="o">])</span>
</code></pre></div></div>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/airframe/highlight/highlight.pack.js"></script><script>hljs.configure({languages:['scala','java','bash']});
hljs.initHighlightingOnLoad();
              </script><script>console.info('\x57\x65\x62\x73\x69\x74\x65\x20\x62\x75\x69\x6c\x74\x20\x77\x69\x74\x68\x3a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x5f\x5f\x0a\x20\x20\x20\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x5f\x20\x20\x2f\x20\x2f\x5f\x20\x20\x20\x20\x20\x20\x5f\x5f\x5f\x5f\x20\x5f\x5f\x5f\x20\x20\x28\x5f\x29\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x28\x5f\x29\x20\x2f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x0a\x20\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x60\x5f\x5f\x20\x5c\x2f\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x20\x2f\x20\x5f\x5f\x2f\x20\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x0a\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x5f\x2f\x20\x2f\x20\x2f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x5f\x5f\x2f\x20\x2f\x20\x20\x2f\x20\x2f\x5f\x2f\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x20\x2f\x5f\x2f\x20\x20\x5f\x5f\x28\x5f\x5f\x20\x20\x29\x0a\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2e\x5f\x5f\x5f\x2f\x5c\x5f\x5f\x2f\x20\x20\x20\x20\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x2f\x20\x20\x20\x5c\x5f\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x0a\x0a\x68\x74\x74\x70\x73\x3a\x2f\x2f\x34\x37\x64\x65\x67\x2e\x67\x69\x74\x68\x75\x62\x2e\x69\x6f\x2f\x73\x62\x74\x2d\x6d\x69\x63\x72\x6f\x73\x69\x74\x65\x73')</script><script>((window.gitter = {}).chat = {}).options = {
room: 'wvlet/airframe'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/airframe/js/main.js"></script></body></html>